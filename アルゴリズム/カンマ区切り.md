# カンマ区切りでの出力
例えば 3桁ごとにカンマ区切りする
~~~
12345678.to_s.gsub(/(\d)(?=\d{3}+$)/, '\1,')
=> 12,345,678
~~~
***

## 仕組み
[gsubメソッド](https://github.com/Tarara33/TIL/blob/main/Ruby/%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89/%E5%8D%98%E4%BD%93/gsub.md#gsub)についてはこちら。  
簡単にいうと、第一引数を第二引数で置き換える。

### 第一引数
第一引数にある正規表現は、  
- `\d` = 数値  
- `?=` = [先読み](https://github.com/Tarara33/TIL/blob/main/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE/%E5%85%88%E8%AA%AD%E3%81%BF%E3%83%BB%E5%BE%8C%E8%AA%AD%E3%81%BF.md#%E5%85%88%E8%AA%AD%E3%81%BF)
- `+` = 「直前の文字」が 1個以上を表す。
- `$` = 行末
~~~
/(\d)(?=\d{3}+$)/
= /(数値一桁)の後に(先読みで数値三桁 +(直前の 3桁数値が 1つ以上) + 行末)/
= /(5)(678 + 行末)/ と 　/(2)(345 +(678) 行末)/
~~~
***

### 第二引数
`\1`は[ここ](https://github.com/Tarara33/TIL/blob/main/%E6%AD%A3%E8%A6%8F%E8%A1%A8%E7%8F%BE/%E3%83%A1%E3%83%A2/%5C1.md)に書いた、  
()で囲んだパターンをキャプチャして参照する変数みたいなもの。  

今回の場合、パターンは`(\d)`で `(?=\d{3}+$)`は先読みアサーションでキャプチャしないから、  
`\1`でアクセスできるのは`(\d)`のみ。  

`\1,`とカンマがついているので、
~~~
gsub(/(5)(678 + 行末)/, '\1,')の場合は
\1 = 5  
\1, = 5,  
となる。
~~~
***

## 最後に
gsubメソッドで   
5が 5,に置き換わり
2が 2,に置き換わることによって  
12,345,678となる。
***
