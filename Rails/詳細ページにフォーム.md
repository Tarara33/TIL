[![Image from Gyazo](https://i.gyazo.com/7a4b840be71b88e3c35c2c128ea93f7b.png)](https://gyazo.com/7a4b840be71b88e3c35c2c128ea93f7b)

ã“ã®å†™çœŸã®ã‚ˆã†ã«ã‚ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®è©³ç´°ãƒšãƒ¼ã‚¸ã«ã€    
ä»–ãƒ¢ãƒ‡ãƒ«ã®ãƒ•ã‚©ãƒ¼ãƒ ç”»é¢ã‚’ä½œæˆã€ç™»éŒ²ã™ã‚‹æ–¹æ³•ã€‚
***

# æ‰‹é †
## â‘ ãƒ¢ãƒ‡ãƒ«ä½œã‚‹
ä¾‹é¡Œã®å†™çœŸã§ã„ã†ã‚³ãƒ¡ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«ã‚’ä½œã‚‹
~~~
$ rails g model comments body:text user:references board:references
~~~
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚„ã€ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã€‚
***

## ã€€â‘¡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ä½œã‚‹
~~~
$ rails g controller comment
~~~
***

## â‘¢ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹
URLã‚’ã€Œboards/board_id/commentsã€ã«ã—ãŸã„ã®ã§ãƒã‚¹ãƒˆã™ã‚‹ã€‚
~~~
resource :boards do
  resource :comments, shallow: true
end
~~~
ãƒã‚¹ãƒˆã¯æµ…ã„æ–¹ãŒã„ã„ã®ã§æœ€ä½é™ã§ä½œã‚‹ã€‚
***

## â‘£ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®è¨­å®š
ä¾‹é¡Œã ã¨boardãƒ¢ãƒ‡ãƒ«ã®showãƒšãƒ¼ã‚¸ã«commentãƒ•ã‚©ãƒ¼ãƒ ã¨ä¸€è¦§è¡¨ç¤ºãŒã‚ã‚‹ã®ã§ã€    
~~~
[app/controllers/boards_controller.rb]

def show
  @board = Board.find(params[:id])
  @comment = Comment.new
  @comments = @board.comments.includes(:user).order(created_at: :desc)
end

[app/controllers/comments_controller.rb]
class CommentsController < ApplicationController

  def create
    comment = current_user.comments.build(comment_params)
    if comment.save
      redirect_to board_path(comment.board), success: t('defaults.message.created', item: Comment.model_name.human)
    else
      redirect_to boards_path(comment.board), danger: t('defaults.message.not_created', item: Comment.model_name.human)
      
    end
  end

  private

  def comment_params
    params.require(:comment).permit(:body).merge(board_id: params[:board_id])
  end
end
~~~
ğŸ’¡ãƒã‚¤ãƒ³ãƒˆ
~~~
1. commentã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¯indexã‚„showã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãªã©viewãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒãŸãªã„ã®ã§ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ã«ã—ã¦ã‚‹ï¼ˆï¼ ã¤ã‘ã¦ãªã„ï¼‰
2. current_user...ã§user_idã‚’ã€ã€€comment_paramsã§board_idã‚’æ··ãœã¦ã‚‹ã€‚
3. redirect_toã§ï¼ˆï¼ commentï¼‰ãªã©ã§ã¯ãªãã€(comment.board)ã¨ã—ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆã¨ç´ã¥ã„ã¦ã‚‹æ²ç¤ºæ¿ã®idã‚’æ¸¡ã™ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã€‚
4. elseç¯€ã‚‚redirect_toã«ã—ã¦ã‚‹
~~~
[![Image from Gyazo](https://i.gyazo.com/a9658f7c409c68155509cc591e666903.png)](https://gyazo.com/a9658f7c409c68155509cc591e666903)
***

## â‘£ãƒ•ã‚©ãƒ¼ãƒ ä½œæˆ
boardã®è©³ç´°Viewã«ãƒ•ã‚©ãƒ¼ãƒ å…¥ã‚Œã‚‹
~~~
[app/views/comments/_form.html.erb] =>app/views/boards/show.html.erbã«randerã™ã‚‹

<div class="row mb-3">
    <div class="col-lg-8 offset-lg-2">
      <%= form_with(model: comment, url: board_comments_path(board) => comments#createã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«é€ã£ã¦ã‚‹, local: true) do |f| %>
      <%= render 'shared/errors', object: f.object %>
      
        <%= f.label :body %>
        <%= f.text_area :body, class: 'form-control mb-3', rows: 2, placeholder: 'ã‚³ãƒ¡ãƒ³ãƒˆ' %>

        <%= f.submit class: 'btn btn-primary' %>
        <% end %>
    </div>
  </div>
~~~
ğŸ’¡form_withã§URLã‚’æŒ‡å®šã—ã¦ã„ã‚‹ç†ç”±
[![Image from Gyazo](https://i.gyazo.com/452b65f219b91afee6465bc3759d0d12.png)](https://gyazo.com/452b65f219b91afee6465bc3759d0d12)
[![Image from Gyazo](https://i.gyazo.com/5202338a266a46dc2a39319e0df376ee.png)](https://gyazo.com/5202338a266a46dc2a39319e0df376ee)
***

### +a
~~~
  <%= form_with(model: comment, url: [board, comment], local: true) do |f| %>
ã¨è¨€ã†æ›¸ãæ–¹ã‚‚ã‚ã‚‹ã€‚
~~~
[![Image from Gyazo](https://i.gyazo.com/fddb9aa87c7f9afeb04ecf58028b0066.png)](https://gyazo.com/fddb9aa87c7f9afeb04ecf58028b0066)
***
