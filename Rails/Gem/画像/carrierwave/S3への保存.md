# Gemの導入
大まかに２種類ある(両方入れてもいい)

## gem 'fog-aws'
fogクラウドサービスプロバイダの一部で AWSの異なるサービス（S3、EC2、RDSなど）にアクセスするためのプラグイン。  
AWS以外の他のクラウドプロバイダにも接続できる。
~~~
[Gemfile]

$ gem 'fog-aws'
$ bundle
~~~
***

### ⚠️ gem 'fog'だとエラーでた
勘違いで gem 'fog'を bundleしたら以下のようなエラーが出た。  
~~~
An error occurred while installing ovirt-engine-sdk (4.3.0), and Bundler cannot continue.
Make sure that gem install ovirt-engine-sdk -v '4.3.0' --source 'https://rubygems.org/' succeeds before bundling.
~~~

fogは各種プラグイン的な奴を全部搭載しているのでインストールがとても大変。  
なので公式も AWSなら `fog-aws`使ってねと言っていた。
***

## gem 'aws-sdk-s3'
Amazonが提供する公式の AWS SDKの一部であり、直接的に AWSリソースにアクセスするためのライブラリ。
特に S3に関する操作をサポートしてくれる。  
~~~
[Gemfile]

group :production do
  gem "aws-sdk-s3", require: false
end

$ bundle config set --local without 'production'
$ bundle
~~~
***

# バケットの作成

# ストレージファイルの編集
「config/storage.yml」に以下を追加
~~~
[config/storage.yml]

amazon:
  service: S3
  access_key_id:     <%= ENV['AWS_ACCESS_KEY_ID'] %>
  secret_access_key: <%= ENV['AWS_SECRET_ACCESS_KEY'] %>
  region:            <%= ENV['AWS_REGION'] %>
  bucket:            <%= ENV['AWS_BUCKET'] %>
~~~
⚠️ ENV[]の中身は gem 'aws-sdk-s3'を使う場合 `AWS`スタートにする。  
gem 'fog-aws'の場合は、任意の環境変数名を設定できる。  

⚠️ renderなど使う場合は renderで設定する環境変数名と、このストレージファイルに書く環境変数名を一致させる！
***

# 環境ファイルの編集
「config/environments/production.rb」を書き換える
~~~
[config/environments/production.rb]

# アップロードされたファイルをローカルファイルシステムに保存する設定
config.active_storage.service = :local

↓

# アップロードされたファイルをAmazon AWSに保存する設定
config.active_storage.service = :amazon
~~~
***
