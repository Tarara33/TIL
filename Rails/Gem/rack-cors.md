[公式](https://github.com/cyu/rack-cors)

# rack-cors
railsを APIとして使う場合に使用する。  
この URLからは rails APIにアクセスしていいよ！などのルールを設定する gem。  

デフォルトでは、Railsは別のドメインからのアクセスを拒否するようになっている。  
例えば、フロントエンドを React、バックエンドを Railsで作ったアプリでは、reactは rails のAPIにアクセスすることができない。
***

## ❓ CORS (Cross-Origin Resource Sharing)
Webサーバー間で異なるオリジン間でのリソース共有を可能にする仕組み。  
これにより、異なるドメイン間でのデータ通信が可能になる。  
例えば、ある Webサイトから別の Webサイトへの Ajaxリクエストを行う場合などに使用される。

### 💡もっとわかりやすくいうと...
~~~
CORSっていうのはね、インターネット上で異なる場所にあるウェブページとデータを交換する時のルールだよ。
例えば、君が作ったウェブページが別の場所にある天気予報のデーターを見たいとき、普通には「知らない人は入れません！」って言われてしまうんだ。

でも、CORSがあると、天気予報のデータを持っているサーバーが「このウェブページはOK！」って指定してくれることで、君のウェブページからでも安全にデータをもらうことができるんだ。
これでウェブページがもっと便利にいろんなデータを使えるようになるんだよ。
~~~
***

# 導入
最初から Gemfileにコメントアウトされてるので外す。
~~~
[Gemfile]
gem "rack-cors"

$ bundle
~~~
***

# CORSの設定
config/initializers/cors.rbを開く。
~~~
[config/initializers/cors.rb]

Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    🩵origins 'localhost:3001'
    💜resource '*',
      💛headers: :any,
      🧡methods: [:get, :post, :put, :patch, :delete, :options, :head]
  end
end
~~~
***

### 🩵 
フロントエンドのURLを設定する。  
ローカルならポート番号、本番なら、アプリの URLを入れる。(`https://gift-compass.com`など)
***

💜 
 `*`このように書くと、「すべてのオリジンからのリクエストを許可する」という意味になる。  
 なので、オリジンがポート番号なら、そのポートで扱われるURL、  
 オリジンが アプリの URLなら、そのホスト名(例: `gift-compass`)をもつアプリの URLからのリクエストを許可するという意味。
 ***

### 💛
`:any`とすることで、すべての HTTPヘッダーを許可する。(リクエストヘッダーやレスポンスヘッダーなど)
***

### 🧡
許可されるHTTPメソッド（リクエストの種類）を指定するためのもの。

#### OPTIONS
Webサーバーがどんな HTTPメソッドをサポートしているかをクライアントに知らせるために使われる。    
これで、例えば CORSのチェックをするときにどんなリクエストができるかを確認できる。

#### HEAD
:getメソッドみたいにサーバーから情報を取得するんだけど、実際のデータの内容は送らずに、データのサイズやタイプ、最終更新日時などの情報だけを返す。  
これでデータをダウンロードする前に、どんなデータがあるのか、更新されているかを確認できる。
***
