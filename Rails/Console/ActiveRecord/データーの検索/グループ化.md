[å‚è€ƒ](https://pikawaka.com/rails/group)  
  
# é›†è¨ˆé–¢æ•°
ä¾‹ã¨ã—ã¦ã“ã®ã‚ˆã†ãª Userãƒ†ãƒ¼ãƒ–ãƒ«ãŒã‚ã‚‹ã¨ã™ã‚‹ã€‚
[![Image from Gyazo](https://i.gyazo.com/ca5f27709b2f53de0aab645f54d2d1a4.png)](https://gyazo.com/ca5f27709b2f53de0aab645f54d2d1a4)

## count
ãƒ†ãƒ¼ãƒ–ãƒ«ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°ã‚’æ•°ãˆã¦è¡¨ç¤ºã€‚
~~~
[Rails c ]

$ User.count
=> 7
~~~
***

## sum
æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®åˆè¨ˆå€¤ã‚’è¡¨ç¤ºã€‚
~~~
[Rails c ]

$ User.sumï¼ˆ:age)
=> 241 (å¹´é½¢ã®åˆè¨ˆ)
~~~
***

## average	
æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®å¹³å‡å€¤ã‚’è¡¨ç¤ºã€‚
~~~
[Rails c ]

$ User.averageï¼ˆ:age)
=> 34 (å¹´é½¢ã®å¹³å‡)
~~~
***

## maximum
æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€å¤§å€¤ã‚’è¡¨ç¤ºã€‚
~~~
[Rails c ]

$ User.maximumï¼ˆ:tall)
=> 178 (ä¸€ç•ªé«˜ã„èº«é•·)
~~~
***

## minimum
æŒ‡å®šã—ãŸã‚«ãƒ©ãƒ ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®æœ€å°å€¤ã‚’è¡¨ç¤ºã€‚
~~~
[Rails c ]

$ User.minimumï¼ˆ:tall)
=> 154 (ä¸€ç•ªä½Žã„èº«é•·)
~~~
***

### â“ å¥³æ€§ã®æ•°å€¤ã¨ç”·æ€§ã®æ•°å€¤
ä»Šã¾ã§ã®é›†è¨ˆé–¢æ•°ã®ä¾‹ã§ã¯ 7äººã®ä¸­ã§ãã‚Œãžã‚Œæ•°å€¤å‡ºã—ã¦ã„ãŸã‘ã©ã€  
ä¾‹ãˆã°ã€å¥³æ€§ã®å¹³å‡å¹´é½¢ã¨ç”·æ€§ã®å¹³å‡å¹´é½¢ã¨ã‹æ€§åˆ¥ã§ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã¨ã‹ã§ãã‚‹ã‹ãªï¼Ÿï¼Ÿ  
ã§ãã¾ã™ï¼ï¼  

# ã‚°ãƒ«ãƒ¼ãƒ—åŒ– (groupãƒ¡ã‚½ãƒƒãƒ‰)
å–å¾—ã—ãŸå€¤ã‚’ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ãã‚Œã‚‹ã€‚  
âš ï¸ åŸºæœ¬çš„ã« groupã¯é›†è¨ˆé–¢æ•°ã¨ä½¿ã†ã€‚  

## count + group
ä¾‹: ç”·å¥³åˆ¥ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•°
~~~
[Rails c ]

$ User.group(:sex).count
=> {"å¥³æ€§"=>3, "ç”·æ€§"=>4}
~~~
***

## sum + group
ä¾‹: ç”·å¥³åˆ¥ã®å¹´é½¢ã®åˆè¨ˆ
~~~
[Rails c ]

$ User.group(:sex).sumï¼ˆ:age)
=> {"å¥³æ€§"=>108, "ç”·æ€§"=>133}
~~~
***

## average + group
ä¾‹: ç”·å¥³åˆ¥ã®å¹´é½¢ã®å¹³å‡
~~~
[Rails c ]

$ User.group(:sex).averageï¼ˆ:age)
=> {"å¥³æ€§"=>36, "ç”·æ€§"=>33}
~~~
***

## maximum + group
ä¾‹: ç”·å¥³åˆ¥ã®ä¸€ç•ªå¤§ãã„æ•°å€¤
~~~
[Rails c ]

$ User.group(:sex)maximumï¼ˆ:tall)
=> {"å¥³æ€§"=>162, "ç”·æ€§"=>178}
~~~
***

## minimum + group
ä¾‹: ç”·å¥³åˆ¥ã®ä¸€ç•ªå°ã•ã„æ•°å€¤
~~~
[Rails c ]

$ User.group(:sex)minimumï¼ˆ:tall)
=> {"å¥³æ€§"=>154, "ç”·æ€§"=>172}
~~~
***

# â­ï¸ selectã¨ã®ä½µç”¨
ActiveRecordã§ã¯é›†è¨ˆé–¢æ•°ã‚’ä½¿ã†ã¨ãã€[select](https://github.com/Tarara33/TIL/blob/main/Rails/Console/ActiveRecord/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%BC%E3%81%AE%E6%A4%9C%E7%B4%A2/%E5%9F%BA%E6%9C%AC.md)ã«ä»–ã®ã‚«ãƒ©ãƒ ã¨ä¸€ç·’ã«æ›¸ãã“ã¨ãŒã‚ã‚‹ã€‚    
ãã®å ´åˆã€groupã«ã¯**é›†è¨ˆé–¢æ•°ã®ã‚«ãƒ©ãƒ ä»¥å¤–**ã¯å…¥ã‚Œãªã„ã€‚
~~~
[rails c]

$ User.select("user.id, user.name, sum(payment.amount) as money").joins(:payment).group(:id) ðŸ’¡é›†è¨ˆé–¢æ•°ã® moneyå…¥ã‚Œãªãã¦OK!
~~~
Userãƒ†ãƒ¼ãƒ–ãƒ«ã¨æ”¯æ‰•ã„ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµåˆã—ã€ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¦ã€å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«æ”¯æ‰•ã„ç·é¡ã‚’è¨ˆç®—ã—ã¦ã„ã‚‹ã€‚
***

## â“ ã©ã†ã‚„ã£ã¦ groupã«å…¥ã‚Œã‚‹ã‚«ãƒ©ãƒ æ±ºã‚ã‚‹ï¼Ÿï¼Ÿ
groupã«å…¥ã‚Œã‚‹ã‚«ãƒ©ãƒ ã‚’æ±ºã‚ã‚‹ã¨ãã¯ã€é›†ç´„ã—ãŸã„ç¯„å›²ã‚’è€ƒãˆã‚‹ã¨ã„ã„ã€‚    
ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã®åˆè¨ˆå£²ä¸Šã‚’èª¿ã¹ãŸã„å ´åˆã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼idã‚’ groupã«å…¥ã‚Œã‚‹ã€‚    
ä¸€æ–¹ã§ã€æ—¥ä»˜ã”ã¨ã®å£²ä¸Šã‚’çŸ¥ã‚ŠãŸã„ãªã‚‰ã€æ—¥ä»˜ã‚’ groupã«å…¥ã‚Œã‚‹ã€‚    
    
é‡è¦ãªã®ã¯ã€ã©ã®ãƒ¬ãƒ™ãƒ«ã§ãƒ‡ãƒ¼ã‚¿ã‚’é›†ç´„ã—ãŸã„ã‹ã‚’æ˜Žç¢ºã«ã™ã‚‹ã“ã¨ï¼
***

# ã‚°ãƒ«ãƒ¼ãƒ—åŒ–å¾Œã®æ¤œç´¢ (having)
groupã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ãŸå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ¼ã‹ã‚‰æŽ¢ã™ã¨ãã¯ã€ whereã§ã¯ãªã havingã«ãªã‚‹ã€‚
~~~
[rails c]

$ Test.select(title, sum(:point)).group.(title).having("point >= 60")
~~~
***

## â“ where ã‹ having ã‹
- where      
ã¾ãšåˆã‚ã«è¡Œã®çµžã‚Šè¾¼ã¿ã‚’è¡Œã„ã€ãã®æ¬¡ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã€ãã—ã¦é›†è¨ˆãƒ»åˆ—é¸æŠžã‚’è¡Œã†ã€‚    
      
- having    
ä¸Šè¨˜ã®è¡Œç¨‹ãŒçµ‚ã‚ã‚Šé›†è¨ˆçµæžœãŒã™ã¹ã¦ãã‚ã£ãŸæœ€å¾Œã®æ®µéšŽã§çµžã‚Šè¾¼ã¿ãŒè¡Œã‚ã‚Œã‚‹ã€‚    
ãã®ãŸã‚ã€é›†è¨ˆé–¢æ•°ã‚’è¨˜è¿°ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã¨ãªã‚‹ã€‚
***

ã¤ã¾ã‚Šã€ä¾‹ãˆã°ã“ã®ã‚³ãƒ¼ãƒ‰ã§ whereã‚’ä½¿ã†ã¨ã€    
ã¾ã é›†è¨ˆå‰ãªã®ã«é›†è¨ˆå¾Œã®çµæžœãŒ 60ä»¥ä¸Šã¨ã„ã†ã®ã‚’æŽ¢ãã†ã¨ã™ã‚‹ã®ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã€‚
~~~
[rails c]

$ Test.select(title, sum(:point)).group.(title).where("point >= 60")
~~~

ã—ã‹ã—ã€havingãªã‚‰é›†è¨ˆã—ã¦ã‹ã‚‰ã€é›†è¨ˆå¾Œã®çµæžœãŒ 60ä»¥ä¸Šã¨ã„ã†ã®ã‚’æŽ¢ã™ã®ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€‚
~~~
[rails c]

$ Test.select(title, sum(:point)).group.(title).having("point >= 60")
~~~
***
