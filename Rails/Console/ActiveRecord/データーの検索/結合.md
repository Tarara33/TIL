# テーブル結合して探す (joinsメソッド)
テーブル同士を結合するメソッド。
複数のテーブルを結合してクエリを投げるため、効率的にデータを取得できる。

`モデル名.joins(:結合モデル名)...`という書き方。
~~~
[rails c]

$ Post.joins(:user).where(user: {name: 'Tarara'}).size
=> ユーザーネームが Tararaの人の投稿数を検索
~~~
***

## ❓ joinsした時の 検索の書き方
### 検索対象のカラムが元のモデルにある場合
王道に`whereや find_byなど(カラム名: '')`で検索する。  
 
例: Postモデルに Userモデルを joinsして、検索したいのは Postモデルの titleカラムの時 
~~~
[rails c]

$ Post.joins(:user).find_by(title: 'Rails')
~~~
***

### 検索対象のカラムが結合先のモデルにある場合
`whereや find_byなど(結合モデル名: {カラム名： ''})`とハッシュでかく。

例: Postモデルに Userモデルを joinsして、検索したいのは Userモデルの nameカラムの時 
~~~
[rails c]

$ Post.joins(:user).where(user: { name: 'Tarara' })
~~~
***

## ❓ アソシエーションしてても joins使っていいの？？
結論、いい！ 
joinsを使うと何がいいかというと、クエリの発行数が少なくなる。 
 
次の例は、検索結果は同じだが、クエリ発行数がちがう。 
 
### アソシエーション使って検索した場合
~~~
[rails c]

$ Post.find_by(title: '眠い').users.name
=> Postテーブルから、titleが '眠い'の投稿を探すのに 1クエリ
   その投稿に関連する Userの nameを探すのに　1クエリ

計: 2クエリ
~~~
***

### joins使って検索した場合
~~~
[rails c]

$ Post.joins(:user).find_by( title: '眠い').user.name
=> joinsを使って Postと Userテーブルを結合し、その上で条件に合うレコードを探す title　'眠い'を投稿した user nameを探すのに 1クエリ

計: 1クエリ
~~~
***
