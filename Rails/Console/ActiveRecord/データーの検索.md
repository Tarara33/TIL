# allメソッド
全ての Userインスタンスを見る
~~~
$ User.all
~~~
[![Image from Gyazo](https://i.gyazo.com/ae7ef9f8020825faa91ebb640755fbc4.png)](https://gyazo.com/ae7ef9f8020825faa91ebb640755fbc4)
***

# findメソッド
idが１の Userインスタンスを見る
~~~
$ User.find(1)
~~~
[![Image from Gyazo](https://i.gyazo.com/1eda51117d11420cb1901330ae379c43.png)](https://gyazo.com/1eda51117d11420cb1901330ae379c43)
***

# find_byメソッド
first_nameに「s」を含む Userインスタンスを見る
~~~
$ User.find_by(first_name:"s")
~~~
[![Image from Gyazo](https://i.gyazo.com/48b3616a7d3d5b6274ea155c4109f97b.png)](https://gyazo.com/48b3616a7d3d5b6274ea155c4109f97b)
***

## firstメソッド と lastメソッド
テーブルに登録されてる最初と最後の Userインスタンスを見る
~~~
$ User.first
$ User.last
~~~
[![Image from Gyazo](https://i.gyazo.com/9be54afe0407e27a35cbaefdd8735cce.png)](https://gyazo.com/9be54afe0407e27a35cbaefdd8735cce)
***
 
# find_by と find と where
## find
各モデルの idを検索キーとしてデータを取得するメソッド。    
⚠️ id以外の条件で検索不可、取得したいデータの idの値が具体的に分かっている場合に使用する。
~~~
[rails c]
$ Post.find(1)
=> id 1の返ってくる
~~~
***

## find_by
各モデルを id以外の条件で検索するメソッド(idでも検索可能)   
複数の検索条件を指定可能 (⚠️ 返ってくる結果は最初にヒットした1件のみ)   
id及び id以外の条件が分かっている場合、その条件に該当する最初のデータを取得したい場合に使用する。
~~~
[rails c]
$ Post.find_by(id: 1)
=> id 1の返ってくる
~~~
***

## where
各モデルを id以外の条件で検索する場合、該当するデータ全てが返ってくる。
~~~
[rails c]
$ Post.where(id: 1)
=> id 1の返ってくる
~~~
***

### 返ってくるクラス
~~~
[rails c]
$ Post.find(1).class
=> Postクラスのオブジェクト

$ Post.find_by(id: 1).class
=> Postクラスのオブジェクト

$ Post.where(id: 1).class
=> ActiveRecord Relationのオブジェクト

$ Post.where(id: 1).last.class
=> Postクラスのオブジェクト
~~~
⚠️ whereで探してそのクラスのオブジェクトとして返して欲しいなら「.last, .first」つける
***

# テーブル結合して探す(joinsメソッド)
テーブル同士を結合するメソッド。
複数のテーブルを結合してクエリを投げるため、効率的にデータを取得できる。

`モデル名.joins(:結合モデル名)...`という書き方。
~~~
[rails c]

$ Post.joins(:user).where(user: {name: 'Tarara'}).size
=> ユーザーネームが Tararaの人の投稿数を検索
~~~
***

## ❓ joinsした時の 検索の書き方
### 検索対象のカラムが元のモデルにある場合
王道に`whereや find_byなど(カラム名: '')`で検索する。  
 
例: Postモデルに Userモデルを joinsして、検索したいのは Postモデルの titleカラムの時 
~~~
[rails c]

$ Post.joins(:user).find_by(title: 'Rails')
~~~
***

### 検索対象のカラムが結合先のモデルにある場合
`whereや find_byなど(結合モデル名: {カラム名： ''})`とハッシュでかく。

例: Postモデルに Userモデルを joinsして、検索したいのは Userモデルの nameカラムの時 
~~~
[rails c]

$ Post.joins(:user).where(user: { name: 'Tarara' })
~~~
***

## ❓ アソシエーションしてても joins使っていいの？？
結論、いい！ 
joinsを使うと何がいいかというと、クエリの発行数が少なくなる。 
 
次の例は、検索結果は同じだが、クエリ発行数がちがう。 
 
### アソシエーション使って検索した場合
~~~
[rails c]

$ Post.find_by(title: '眠い').users.name
=> Postテーブルから、titleが '眠い'の投稿を探すのに 1クエリ
   その投稿に関連する Userの nameを探すのに　1クエリ

計: 2クエリ
~~~
***

### joins使って検索した場合
~~~
[rails c]

$ Post.joins(:user).find_by( title: '眠い').user.name
=> joinsを使って Postと Userテーブルを結合し、その上で条件に合うレコードを探す title　'眠い'を投稿した user nameを探すのに 1クエリ

計: 1クエリ
~~~
***
