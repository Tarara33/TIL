# å…¥ã‚Šæ–¹ã€€ã¨ã€€å‡ºæ–¹
å…¥ã‚‹ï¼š`$ rails c`    
å‡ºã‚‹ï¼š`$ exit`
***

## sandboxãƒ¢ãƒ¼ãƒ‰
RSpecãªã©ã§ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã—ã¦ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ¼ãŒä¿å­˜ã•ã‚Œã¦ã—ã¾ã†ã¨å„ä»‹ã ãŒã€    
ã“ã®ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ãˆã°ã€exitã™ã‚‹ã¨ã€€rollbackã•ã‚Œã¦å…ƒé€šã‚Šã«ãªã‚‹ã€‚
~~~
$ rails c -s
~~~
***

# reload!
ã„ã¡ã„ã¡ã€Œexitã€ã§å‡ºãªãã¦ã‚‚`$ reload!`ã§å†èª­ã¿è¾¼ã¿ã•ã‚Œã‚‹ã€‚   
ã—ã‹ã— @user = User.last ãªã©å¤‰æ•°å®šç¾©ã—ã¦ãŸæƒ…å ±ã‚‚ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã€‚
***

# DBã®æƒ…å ±ã‚’è¦‹ã‚‹
ä¾‹ãˆã°Userãƒ†ãƒ¼ãƒ–ãƒ«ã®æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å†…ã§ä½œã£ãŸã‚Šã€è¦‹ãŸã‚Šã™ã‚‹ã€‚
~~~
[db/schem.rb]
create_table "users", force: :cascade do |t|
    t.string "email", null: false
    t.string "crypted_password"
    t.string "salt"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.string "first_name", null: false
    t.string "last_name", null: false
    t.index ["email"], name: "index_users_on_email", unique: true
  end
~~~
***

## ä½œã‚‹ã€€ï¼ˆnewã€€ã¨ã€€createï¼‰
ä¾‹ãˆã°æ–°ã—ãUserãƒ¢ãƒ‡ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ãŸã„ã¨ã
~~~
$ user = User.new(name: "Taro")
$ user.save

or

$ User.create(name: "Taro")
~~~
- new...saveã‚’ã—ãªã„ã¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ç™»éŒ²ã•ã‚Œãªã„
- create... saveå«ã‚“ã§ã‚‹
***

## è¦‹ã‚‹
- å…¨ã¦ã®Userã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã‚‹
~~~
$ User.all
~~~
[![Image from Gyazo](https://i.gyazo.com/ae7ef9f8020825faa91ebb640755fbc4.png)](https://gyazo.com/ae7ef9f8020825faa91ebb640755fbc4)
***

- idãŒï¼‘ã®Userã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã‚‹
~~~
$ User.find(1)
~~~
[![Image from Gyazo](https://i.gyazo.com/1eda51117d11420cb1901330ae379c43.png)](https://gyazo.com/1eda51117d11420cb1901330ae379c43)
***

- first_nameã«ã€Œsã€ã‚’å«ã‚€Userã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã‚‹
~~~
$ User.find_by(first_name:"s")
~~~
[![Image from Gyazo](https://i.gyazo.com/48b3616a7d3d5b6274ea155c4109f97b.png)](https://gyazo.com/48b3616a7d3d5b6274ea155c4109f97b)
***

- ãƒ†ãƒ¼ãƒ–ãƒ«ã«ç™»éŒ²ã•ã‚Œã¦ã‚‹æœ€åˆã¨æœ€å¾Œã®Userã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¦‹ã‚‹
~~~
$ User.first
$ User.last
~~~
[![Image from Gyazo](https://i.gyazo.com/9be54afe0407e27a35cbaefdd8735cce.png)](https://gyazo.com/9be54afe0407e27a35cbaefdd8735cce)
***
 
## find_by ã¨ find ã¨ where
### find
å„ãƒ¢ãƒ‡ãƒ«ã®idã‚’æ¤œç´¢ã‚­ãƒ¼ã¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰    
âš ï¸idä»¥å¤–ã®æ¡ä»¶ã§æ¤œç´¢ä¸å¯ã€å–å¾—ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ã®idã®å€¤ãŒå…·ä½“çš„ã«åˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆã«ä½¿ç”¨ã™ã‚‹ã€‚
~~~
[rails c]
$ Post.find(1)
=> id 1ã®è¿”ã£ã¦ãã‚‹
~~~
***

### find_by
å„ãƒ¢ãƒ‡ãƒ«ã‚’idä»¥å¤–ã®æ¡ä»¶ã§æ¤œç´¢ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰(idã§ã‚‚æ¤œç´¢å¯èƒ½)   
è¤‡æ•°ã®æ¤œç´¢æ¡ä»¶ã‚’æŒ‡å®šå¯èƒ½ (âš ï¸è¿”ã£ã¦ãã‚‹çµæœã¯æœ€åˆã«ãƒ’ãƒƒãƒˆã—ãŸ1ä»¶ã®ã¿)   
idåŠã³idä»¥å¤–ã®æ¡ä»¶ãŒåˆ†ã‹ã£ã¦ã„ã‚‹å ´åˆã€ãã®æ¡ä»¶ã«è©²å½“ã™ã‚‹æœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã„å ´åˆã«ä½¿ç”¨ã™ã‚‹ã€‚
~~~
[rails c]
$ Post.find_by(id: 1)
=> id 1ã®è¿”ã£ã¦ãã‚‹
~~~
***

### where
å„ãƒ¢ãƒ‡ãƒ«ã‚’idä»¥å¤–ã®æ¡ä»¶ã§æ¤œç´¢ã™ã‚‹å ´åˆã€è©²å½“ã™ã‚‹ãƒ‡ãƒ¼ã‚¿å…¨ã¦ãŒè¿”ã£ã¦ãã‚‹ã€‚
~~~
[rails c]
$ Post.where(id: 1)
=> id 1ã®è¿”ã£ã¦ãã‚‹
~~~
***

### è¿”ã£ã¦ãã‚‹ã‚¯ãƒ©ã‚¹
~~~
[rails c]
$ Post.find(1).class
=> Postã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

$ Post.find_by(id: 1).class
=> Postã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

$ Post.where(id: 1).class
=> ActiveRecord Relationã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

$ Post.where(id: 1).last.class
=> Postã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
~~~
âš ï¸whereã§æ¢ã—ã¦ãã®ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¿”ã—ã¦æ¬²ã—ã„ãªã‚‰ã€Œ.last, .firstã€ã¤ã‘ã‚‹
***

## è¦‹ã‚‹ï¼ˆã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å…ˆã®æƒ…å ±ï¼‰
ä¾‹ãˆã°Boardãƒ¢ãƒ‡ãƒ«ã¨ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã„ãŸã‚‰Boardãƒ†ãƒ¼ãƒ–ãƒ«ã®æƒ…å ±ã‚‚è¦‹ã‚Œã‚‹ã€‚
~~~
reate_table "boards", force: :cascade do |t|
    t.string "title", null: false
    t.text "body", null: false
    t.integer "user_id"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.string "board_image"
    t.index ["user_id"], name: "index_boards_on_user_id"
  end
~~~
***

- ç‰¹å®šã®Userã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®boardã‚’è¦‹ã‚‹
~~~
$ user = User.first
$ user.boards
~~~
[![Image from Gyazo](https://i.gyazo.com/e5e932e961f2837522f06cb5d31052f2.png)](https://gyazo.com/e5e932e961f2837522f06cb5d31052f2)
***

- ãã®boardãŸã¡ã®ä¸­ã®idãŒï¼”ã®boardã‚’è¦‹ã‚‹
~~~
$ user.boards.find(4)
~~~
[![Image from Gyazo](https://i.gyazo.com/43b89f18ec20497288a8338c8f653fdc.png)](https://gyazo.com/43b89f18ec20497288a8338c8f653fdc)
***

- idãŒï¼”ã®boardã®titleã‚’è¦‹ã‚‹
~~~
$ user.board.find(4).title
~~~
[![Image from Gyazo](https://i.gyazo.com/603459bd4228726782b4348e88324ee1.png)](https://gyazo.com/603459bd4228726782b4348e88324ee1)
***

# ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª
~~~
[model.rb]
class Post < ApplicationRecord
  validates :title,:body, presence: true
  validates :body, length: {in: 5..140}
end

[rails c]
post = Post.new
â­•ï¸post.valid?
=> false
post.errors
=> #<ActiveModel::Errors:0x0000000126e3d3a8 @base=#<Post id: nil, title: nil, body: nil, created_at: nil, updated_at: nil>, @messages={:title=>["can't be blank"], :body=>["can't be blank", "is too short (minimum is 5 characters)"]}, @details={:title=>[{:error=>:blank}], :body=>[{:error=>:blank}, {:error=>:too_short, :count=>5}]}>
å…¥ã£ã¦ã‚‹ã‚‚ã®ã¨ã‚¨ãƒ©ãƒ¼ã®ç†ç”±ä¸¡æ–¹å‡ºã‚‹

post.errors.full_messages
=> ["Title can't be blank", "Body can't be blank", "Body is too short (minimum is 5 characters)"]
~~~
ğŸ’¡ ã¡ãªã¿ã«ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯â­•ï¸éƒ¨åˆ†ã®ã€Œvalid?ã€ã‚’ä½¿ã£ãŸã¨ãã€‚        
ãªã®ã§ã€newã®å¾Œ errorsã—ã¦ã‚‚[]ã¨è¿”ã£ã¦ãã‚‹ã€‚
***

# pluck
ã‚«ãƒ©ãƒ ã®ä¸­ã®æƒ…å ±ãŸã¡ã‚’é…åˆ—ã«ã—ã¦è¿”ã—ã¦ãã‚Œã‚‹ã€‚        
`ãƒ¢ãƒ‡ãƒ«å.plick(:ã‚«ãƒ©ãƒ å)`ã§å®šç¾©ã™ã‚‹ã€‚        
~~~
[rails c]
irb(main):002:0> User.pluck(:first_name)
   (1.2ms)  SELECT "users"."first_name" FROM "users"
=> ["s", "æ‹“æµ·", "ç¾å’²", "å„ªèŠ±", "å¤§è¼”", "å„ª", "å„ª", "èˆ", "æ‚ äºº", "å¤ªä¸€", "å„ªèœ", "æ„›ç¾", "å„ªèœ", "å„ªèŠ±", "è¼", "å¥", "å¤ªéƒ", "å„ªæ–—", "ç¿”", "ç¾å„ª", "m"]
~~~
***

# find_or_create_by
~~~
User.find_by_or_create(name: 'Tarara')
~~~
ã®ã‚ˆã†ã«ä½¿ã„ã€
Userãƒ¢ãƒ‡ãƒ«ã« nameãŒâ€™Tarara'ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¢ã—ã¦ã‚ã‚Œã°è¿”ã™ã€ãªã‘ã‚Œã°ä½œã£ã¦è¿”ã™
ã¨ã„ã£ãŸãƒ¡ã‚½ãƒƒãƒ‰ã€‚
***

# toggle
booleanã®å€¤(true or false)ã‚’åè»¢ã•ã›ã‚‹ã€‚
***

## toggle ã¨ toggle!
- toggle    
åè»¢ã™ã‚‹ãŒã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã¯å¤‰æ›´ã‚’åæ˜ ã—ãªã„ã€‚        
å‡¦ç†æˆåŠŸæ™‚ã«æŒ‡å®šã® booleanã‚’åè»¢ã•ã›ãŸã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è‡ªèº«ã‚’ returnã—ã¦ãã‚Œã‚‹ã€‚(selfã‚’è¿”ã™)
~~~
[rails c]

$ $ user = User.first
$ user.admin?
=> false
$ user.toggle(:admin)
=> userã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æƒ…å ±è¿”ã—ã¦ãã‚‹ã€‚
$ user.admin?
=> false
~~~

      
- toggle!    
åè»¢ã•ã›ã¦ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ã€‚    
å‡¦ç†æˆåŠŸæ™‚ã« trueã‚’ returnã™ã‚‹ã€‚
~~~
[rails c]

$ user = User.first
$ user.admin?
=> false
$ user.toggle!(:admin)
=> ã†ã¾ãã„ã‘ã° trueè¿”ã™ã€‚
$ user.admin?
=> true
~~~
***
