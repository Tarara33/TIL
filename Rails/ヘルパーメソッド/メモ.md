# simple_format
simple_format(文字列)で使用   
動きとしては
- 文字列を`<p>`タグで括る
- 改行は`<br />`を付与
- 連続した改行は`</p><p>`を付与
~~~
[ruby]
test = "こんにちは。
  　　　　今日は晴れです
  
  　　　　明日は雨です"
  
[rails]
simple_format(test)
→実行  
  <p>こんにちは。<br>
  　　　　今日は晴れです</p>
  <p>明日は雨です</p>
  
と変換される
~~~

## オプション
- sanitize:...true or falseで選択    
trueにするとテキストに含まれる一部のセキュリティ面で危険なHTMLタグを取り除いてくれる
- wrapper_tag:...通常pタグだが、例えばdivタグで囲いたいときなどに使う
- hメソッド...タグもそのまま出してくれる。
~~~
[ruby]
test = "こんにちは。
  　　　　今日は晴れです<h2>
  
  　　　　明日は雨です"
  
[rails オプション無し]
simple_format(test)
→実行  
  <p>こんにちは。<br>
  　　　　今日は晴れです</p>
  <p>明日は雨です</p>

→出力
  こんにちは。
  今日は晴れです。
  明日は雨です。
  
[rails オプション有り]
simple_format(h(test), sanitize:false, wrapper_tag: "div")
→実行  
  <div>こんにちは。<br>
  　　　　今日は晴れです<h2></div>
  <div>明日は雨です</div>

→出力
  こんにちは。
  今日は晴れです<h2>
  明日は雨です
~~~
***

# link_toメソッド
link_toは`<a>`タグを作るためのヘルパーメソッド    
`<%= link_to "表示文字列", "URL or パス" %>`　と   
第一引数に表示される文字列、第二引数にリンク先にURLもしくはパス
***

## 第二引数に何を使うか
- pathメソッド    
ターミナルで`rails or bin/rails routes`とすると
~~~
Prefix   Verb   URI Pattern                                                                              Controller#Action
    root GET    /                                                                                        tasks#index
   tasks GET    /tasks(.:format)                                                                         tasks#index
         POST   /tasks(.:format)                                                                         tasks#create
new_task GET    /tasks/new(.:format)                                                                     tasks#new
...省略
~~~
routes.rbファイルにあるやつを出してくれるので一番左の`Prefixにある文字＋_path`で作れる。   
また、idが必要な場合も`Prefixにある文字＋_path(インスタンス名)`とする。    
⚠️３番目のPOSTは上のGETと同じPrefixなので省略されてる。

***
- モデルのインスタンスを使う
  - 指定したインスタンスのクラス名をスネークケースに変更  
  - `_path`をつける
***

-コントローラ名 + アクション名で指定する(Prefixない場合)    
`<%= link_to "表示文字列", controller: :posts, action: :show, id: 100 %>`と   
routesのコントローラー名＃アクションのところを使う
***

## オプションつけれる
- classの指定    
bootstrapなど使うときは`<%= link_to "表示文字列", "", class: "btn btn-primary" %>などと書く
***

- targetをつける（別タブで開く）    
link_to で target 属性を指定するには、target: 属性と rel: 属性を記述する     
`<%= link_to "Google 検索！", "https://google.com", target: "_blank", rel: "noopener" %>`
***

- HTTPメソッドをGET以外にする   
~~~
Prefix   Verb   URI Pattern                                                                              Controller#Action
    root GET    /                                                                                        tasks#index
   tasks GET    /tasks(.:format)                                                                         tasks#index
         POST   /tasks(.:format)                                                                         tasks#create
new_task GET    /tasks/new(.:format)                                                                     tasks#new
...省略
~~~
ここでいうVerbがHTTPメソッドにあたる    
デフォルトではGETだがPOSTやDELETEなど変えたいときは`method: :変えたいHTTPメソッド名`とする   
`<%= link_to "削除", post_path(1), method: :delete %>`
***

- confirm ダイアログを表示する    
link_to でこれを実現する場合は、dataオプションに、キー=confirm、値=表示するメッセージとするハッシュを指定する   
`<%= link_to "削除", post_path(1), method: :delete, data: { confirm: '本当に削除しますか？' } %>`
***

- マウスイベント   
マウスイベントに対する Javascript による処理を記述することもできる。    
`<%= link_to "クリック！", onclick: 'alert("メッセージ");' %>`    
onclick以外にも設定できるので調べて使う
***

- 画像にリンクをつける    
⚠️aタグの中に別のタグを含めるように生成する場合は、link_toにブロック(do 〜 end)を渡す必要がある
⚠️これまでは第1引数が表示文字列、第2引数がリンク先だったが、do 〜 end を指定するときは第1引数がリンク先となる
~~~
<%= link_to "URL or パス" do %>
  ここにタグを記述
<% end %>
~~~
***

# path　と　urlの違い
- `_path`...相対パス、redirect_to以外で使用する
- `_url`...絶対パス、redirect_toの時にセットで使用する(HTTPの仕様上、リダイレクトのときに完全なURLが求められるので)


# image_tag
画像入れる時のヘルパーメソッド   
~~~
 <%= image_tag "画像パスorURL", alt: "Rails icon", id: "assets", class: "image", width: "300px" %>

[例]
<%= image_tag ('sample.png') %>
で、app/assets/images/配下のファイルだいたい拾ってきてくれる
~~~
***

# stylesheet_link_tag と　javascript_include_tag
ビューファイルにJavascriptファイルとCSSファイルを読み込むときに使う    
第一引数は"ファイル名（拡張子省略可能）"
~~~
[application.html.erb]
<%= stylesheet_link_tag "application", media: all, "data_turbolinks_track": "reload" %>
<%= javascript_include_tag "application", "data_turbolinks_track": "reload" %>

=> それぞれ、アセットパイプラインで生成されたapplication.cssとapplication.jsを読み込んでいる
~~~
💡"data_turbolinks_track": "reload"   
Turbolinksというジェムの動作を指定している（Rails newで組み込まれている）    
ファイルが変更された場合は、ファイル全体をリロードする設定にしている。   
Turbolinksはページの一部に変更があったときは変更点のみ読み込むので高速になる。    
一方で、JSやCSSなどの外部ファイルの中身に変更があると、ページがリロードされないため変更内容が反映されず、   
ページがうまく表示できなくなる。これを防ぐために全体をリロードする指定にしている。
***

# csrf_meta_tags と csp_meta_tag
## csrf_meta_tags
セキュリティトークン（CSRFトークン）を生成し、メタタグとして出力する。    
これにより、ブラウザがトークンを読み取り、ウェブフォームなどに自動的に挿入することができる。    
このトークンは、CSRF攻撃からの保護の一環として使用される。
***

## csp_meta_tag
CSPは、ブラウザに対して実行を許可するソース（スクリプト、スタイルシート、画像など）を指定するポリシーを定義する。    
これにより、攻撃者が悪意のあるスクリプトを注入するための一部の攻撃ベクトルを制限することができる。    
このヘルパータグはCSPメタタグを自動的に生成し、    
生成されたCSPメタタグは、ブラウザに対して適切なCSPポリシーを設定する。    
XSS攻撃の対策の一部。
***
~~~
[application.html.erb]
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <meta lang='ja'>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
~~~
***

