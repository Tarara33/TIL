# ❓ アソシエーションとポリモーフィック関連の違い
どちらもモデル間の関連を表すための概念。    

## アソシエーション
特定のモデル間の「1対1」「1対多」「多対多」の関連を定義する。      
定義する時は外部キーカラムを追加する。  
  
[![Image from Gyazo](https://i.gyazo.com/a67765bf6a260185e378a4d9f842b924.png)](https://gyazo.com/a67765bf6a260185e378a4d9f842b924)
***

## ポリモーフィック関連
1つのモデルが複数の他のモデルと関連することをいう。    
これにより、1つのテーブルで複数の異なるモデルを参照できる。       
定義するときは      
- 「ポリモーフィック関連を表す名前_type」      
- 「ポリモーフィック関連を表す名前_id」      
という 2つのカラムを追加するだけでいい。  
    
[![Image from Gyazo](https://i.gyazo.com/638cd06784d37cb289033780f22f058a.png)](https://gyazo.com/638cd06784d37cb289033780f22f058a)

⚠️ アソシエーションと違って外部キーをつけてテーブルを繋ぐ訳ではないので、データベースレベルでの参照整合性は保証されない。   
***

# ❓ ポリモーフィック関連を使うと何がいい？？
例えば、先ほどのテーブルの例で言うと、  
新しく本(book)テーブルができた時にこのテーブルも写真(picture)テーブルと関連づけたいとする。

## アソシエーションの場合
写真(picture)テーブルに新たに外部キーカラム追加する。  
  
[![Image from Gyazo](https://i.gyazo.com/ca68e02c410229319b5a436b96c43106.png)](https://gyazo.com/ca68e02c410229319b5a436b96c43106)  
***

## ポリモーフィック関連の場合
特にカラムなどは追加しなくて OK!  
モデルにコード書けば関連づけできる。  
  
[![Image from Gyazo](https://i.gyazo.com/f4a4ff9a1d90d452805e70893cd68f2d.png)](https://gyazo.com/f4a4ff9a1d90d452805e70893cd68f2d)
***

### 💡 つまり...
新たなモデルが増えても、追加するカラムは変わらないから楽に関連を定義できる！
***

# 使い方
例えば、記事に入れるブロック(article_block)モデルがあり、 
~~~
create_table "article_blocks", force: :cascade do |t|
    t.integer "article_id"
    t.string "blockable_type"
    t.integer "blockable_id"
    t.integer "level", default: 0, null: false
  end
~~~
    
これを  
文章(sentences)モデル
~~~
create_table "sentences", force: :cascade do |t|
    t.text "body"
  end
~~~
  
写真(media)モデル  
~~~
create_table "media", force: :cascade do |t|
    t.integer "media_type", default: 0, null: false
    t.string "name"
  end
~~~
  
外部SNSの埋め込み(embeds)モデルと関連づけたい。 
~~~
create_table "embeds", force: :cascade do |t|
    t.integer "embed_type", default: 0, null: false
    t.string "identifier"
  end
~~~
    
やりたいこととしては article_blockを作成する時に使う、    
文章、写真、外部SNSの埋め込みという別テーブルに切り分けたコンテンツを  
同じように扱えるようにすることでテーブル構造をシンプルにすること。  
***

# ポリモーフィックの設定
関連づけたいモデルに以下のように書く。
~~~
[app/models/article_block.rb]

class ArticleBlock < ApplicationRecord
belongs_to :blockable, polymorphic: true, dependent: :destroy
end
~~~
💡 「:blockable」はテーブル名ではないので、blockableモデルがある訳ではない。    
ここでの blockableは、ポリモーフィック関連を表すための名前。    
