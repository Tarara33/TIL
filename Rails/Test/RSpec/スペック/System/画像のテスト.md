# ç”»åƒã‚’ä½¿ã£ãŸã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
ç”»åƒãŒãã¡ã‚“ã¨æŠ•ç¨¿ã§ãã‚‹ã‹ãªã©ã€ãƒ†ã‚¹ãƒˆã§ç”»åƒã‚’ç”¨ã„ã‚‹å ´åˆã€‚

# ç”»åƒãƒ‡ãƒ¼ã‚¿ãƒ¼ã‚’ specãƒ•ã‚©ãƒ«ãƒ€ã«è¿½åŠ ã™ã‚‹ã€‚
ã€Œspec/fixtures/images/ã€é…ä¸‹ã«ç”»åƒã‚’ä¿å­˜ã™ã‚‹ã€‚
ãƒ•ã‚©ãƒ«ãƒ€ã¯æ‰‹å‹•ã§ä½œã‚‹ã€‚
***

## ãƒ•ã‚©ãƒ«ãƒ€ã¸ã®ãƒ‘ã‚¹è¨­å®š
ã€Œspec/rails_helper.rbã€ã® 37è¡Œç›®ã‚ãŸã‚Šã« fixturesãƒ•ã‚©ãƒ«ãƒ€ã¸ã®ãƒ‘ã‚¹ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ãŸã‚‰å¤–ã™ã€‚
***

# ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹
~~~
require 'rails_helper'

RSpec.describe "AdminArticlesEyecatches", type: :system do
  let(:admin) {create :user, :admin}
  let!(:article) {create :article}

  before do
    login(admin)
    visit admin_articles_path
    click_link 'ç·¨é›†', href: edit_admin_article_path(article.uuid)
    ğŸ§¡attach_file 'article[eye_catch]', "#{Rails.root}/spec/fixtures/images/runteq_man.png"
    click_button 'æ›´æ–°ã™ã‚‹'
  end

  describe 'ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã®æ¨ªå¹…ã‚’å¤‰æ›´' do
    context 'æ¨ªå¹…ã‚’100~700pxä»¥å†…ã«ã—ãŸå ´åˆ' do
      it 'è¨˜äº‹ã®æ›´æ–°ã«æˆåŠŸã—ã¦ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒãŒç¢ºèªã§ãã‚‹' do
        eyecatch_width = rand(100..700)
        fill_in 'article[eyecatch_width]', with: eyecatch_width
        click_button 'æ›´æ–°ã™ã‚‹'
        expect(page).to have_content('æ›´æ–°ã—ã¾ã—ãŸ')
        click_link 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼'
        switch_to_window(windows.last)

        expect(page).to have_css('.eye_catch'), 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒšãƒ¼ã‚¸ã«eye_catchã¨ã„ã†classãŒå­˜åœ¨ã—ã¾ã›ã‚“'
        expect(current_path).to eq(admin_article_preview_path(article.uuid)), 'ç·¨é›†ã—ãŸè¨˜äº‹ã®ãƒšãƒ¼ã‚¸ã«é·ç§»ã—ã¦ã„ã¾ã›ã‚“'
        ğŸ’›expect(page).to have_selector("img[src$= 'runteq_man.png']"), 'ç”»åƒãŒæ­£ã—ãã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã›ã‚“'
      end
    end
~~~
ğŸ§¡ ç”»åƒæŒ¿å…¥ã¯ attach_fileãƒ¡ã‚½ãƒƒãƒ‰ä½¿ã†ã€‚
  
ğŸ’› src$ã® ï¼„ã¯ãƒ¡ã‚¿æ–‡å­—ã§æ­£è¦è¡¨ç¾å†…ã§ ï¼„ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€å¯¾è±¡ã®æ–‡å­—åˆ—ãŒè¡Œæœ«ã«ä¸€è‡´ã™ã‚‹ã“ã¨ã‚’è¡¨ã™ã€‚    
ã¤ã¾ã‚Š img[src$='runteq_man.png']ã¨ã„ã†ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã¯ã€  
srcå±æ€§ã®å€¤ãŒ "runteq_man.png" ã§çµ‚ã‚ã‚‹ imgè¦ç´ ã‚’é¸æŠã™ã‚‹ãŸã‚ã®ã‚‚ã®ã€‚  
  
[ã“ã£ã¡ã§ã‚‚æ›¸ã„ã¦ãŸ](https://github.com/Tarara33/TIL/blob/main/Rails/Test/Capybara.md)
***

# è¤‡æ•°ç”»åƒã®å ´åˆã®ãƒ†ã‚¹ãƒˆ
~~~
attach_file 'site[main_images][]', ["#{Rails.root}/spec/fixtures/images/runteq_man_top.png",
                                    "#{Rails.root}/spec/fixtures/images/runteq_man.png"]

attach_file('site_main_images', %w(spec/fixtures/images/runteq_man_top.png spec/fixtures/images/runteq_man.png))
~~~
ãªã©
***
