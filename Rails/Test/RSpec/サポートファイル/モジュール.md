# サポートモジュール
rspec内で何度も出てくる処理をまとめられる。    
例えば、ログイン処理とか。    
***

# ファイルの作り方
「spec/support/」配下に「〇〇_support.rb」というファイルを作る。(手動)    
〇〇はモジュール名(login_support.rbとか)
***

# ファイルにコードを書く
~~~
[spec/support/login_support.rb]

module LoginSupport
  def login(user)
    visit login_path
    fill_in 'Email', with: user.email
    fill_in 'Password', with: "password"
    click_button 'Login'
  end
end
~~~

# エラーにハマった（忘備録)
最初はモジュール内でこのように書いていた。
~~~|
fill_in 'Email', with: user.email
fill_in 'Password', with: user.password
~~~
しかし、テストで passwordが入力されなかった。
***

## なぜ？？
答えは、Userモデルに passwordカラムはないから！    
sorceryを使っているので、フォームには passwordというラベルがあるが、実際保存されるのは :crypted_passwordカラム。    
そのため user.passwordとしても　nilが返る。
~~~
[Userモデルのバリデーションより]
validates :password, length: { minimum: 3 }, if: -> { new_record? || changes[:crypted_password] }
validates :password, confirmation: true, if: -> { new_record? || changes[:crypted_password] }
validates :password_confirmation, presence: true, if: -> { new_record? || changes[:crypted_password] }
~~~
~~~
[rails c]
$ user = User.first
$ user.email
=> user@example.com
$ user.password
=> nil
~~~
***

## 結果
固定値である文字列をテストデータとして登録し、同じ文字列を使ってログインするように作成した！
~~~
fill_in 'Password', with: "password"
~~~
***
