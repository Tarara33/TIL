[å‚è€ƒ](https://autovice.jp/articles/177)

# Rakeã‚¿ã‚¹ã‚¯ã¨ã¯
Ruby ï¼‹ã€€Makeã€€ = Rakeã¨ã„ã†æ„å‘³ã€‚    
Rubyã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ä½œæˆã—ã¦ãŠãå¿…è¦ã«å¿œã˜ã¦å‘¼ã³å‡ºã—å®Ÿè¡Œã™ã‚‹äº‹ãŒå‡ºæ¥ã‚‹æ©Ÿèƒ½ã€‚  
ä¾‹ãˆã°ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æŠ•å…¥ã€å®šæœŸçš„ãªãƒãƒƒãƒå‡¦ç†ãªã©ã€    
ä¸€é€£ã®æ‰‹é †ã‚’ã¾ã¨ã‚ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ãŒã§ãã€é »ç¹ã«è¡Œã†ä½œæ¥­ã‚„è¤‡é›‘ãªä½œæ¥­ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã®ã«å½¹ç«‹ã¤ã€‚
***

# ä½œã‚Šæ–¹
åŸºæœ¬çš„ã« Gemã¯ rails newã—ãŸã¨ãã«å…¥ã£ã¦ã‚‹ãŒãªã‘ã‚Œã°è¿½åŠ ã€‚
~~~
gem 'rake'
~~~

ä»Šå›ã¯ã€ä¾‹ã¨ã—ã¦ Helloã¨è¡¨ç¤ºã™ã‚‹ã‚¿ã‚¹ã‚¯ã‚’ä½œã‚‹ã€‚
~~~
$ rails g task ãƒ•ã‚¡ã‚¤ãƒ«å

[ä¾‹]
$ rails g task hello
~~~
***

## ã‚¿ã‚¹ã‚¯ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†
ä¸­èº«ã®åˆæœŸè¨­å®šã¯ã“ã¡ã‚‰ã€‚
~~~
[lib/tasks/hello.rake]

namespace :greet do
end
~~~

ã‚³ãƒ¬ã«å½“ã¦ã¯ã‚ã¦å®Ÿè£…ã™ã‚‹ã€‚
~~~
namespace :ã‚¿ã‚¹ã‚¯ã®ãƒ•ã‚¡ã‚¤ãƒ«å do
  desc 'ã‚¿ã‚¹ã‚¯ã®èª¬æ˜'
  task :ã‚¿ã‚¹ã‚¯ã®åç§° do
    # ã‚¿ã‚¹ã‚¯ã®å‡¦ç†å†…å®¹
  end
end


[ä¾‹]
namespace :greet do
  desc 'ãƒãƒ­ãƒ¼ã¨å‡ºåŠ›ã™ã‚‹'
  task :say_hello do
    puts 'HELLO!'
  end
end
~~~
***

## ã‚¿ã‚¹ã‚¯ã®ç¢ºèª
`$ rails -T`ã§è‡ªåˆ†ã§ä½œæˆã—ãŸ Rakeã‚¿ã‚¹ã‚¯ã‚’å«ã‚€ Rakeã‚¿ã‚¹ã‚¯ã®ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚
~~~
$ rails -T

rails hello:say_hello                            # helloã¨è¡¨ç¤ºã™ã‚‹
~~~
ğŸ’¡ ä¸€è¦§ã®ä¸­ã«ã¯ã€Railsã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ Rakeã‚¿ã‚¹ã‚¯ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ã€‚  
ä¾‹ãˆã°ã€rails db:migrateãªã©ã„ã¤ã‚‚ä½¿ç”¨ã—ã¦ã„ã‚‹ã‚³ãƒãƒ³ãƒ‰ã‚‚ã‚ã‚Šã€    
ãã®å®Ÿæ…‹ã¯ã€Railsã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ Rakeã‚¿ã‚¹ã‚¯ã ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹ã€‚  
***

# â­ï¸ ã‚¿ã‚¹ã‚¯ã®å‡¦ç†ãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†å ´åˆ
ä¾‹ãˆã°ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ ãªã©ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†å ´åˆã¯
taskã®åç§°ã®å¾Œã«ã€€`:environment`ã¤ã‘ã‚‹ã€‚
~~~
[lib/tasks/user.rake]

namespace :user do
  desc 'ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œã‚‹'
  task create_user: :environment do
    User.create(name: 'Tarara')
  end
end

ã¾ãŸã¯
task :create_userã€€=> :environment do
ã¨ã‚‚æ›¸ã‘ã‚‹ã€‚
~~~
âš ï¸ :environmentã¯ã‚¿ã‚¹ã‚¯ã®åç§°ã®ã€Œ:ã€ã®ä½ç½®æ³¨æ„ï¼
***

# å¼•æ•°æ¸¡ã™ã‚¿ã‚¹ã‚¯
~~~
[å¼•æ•°æ¸¡ã™ã‚¿ã‚¹ã‚¯]

namespace :greet do
  desc 'Hello + nameã®è¡¨ç¤º'
  task :say_hello, [:name] do |_, word|
    puts "HELLO! #{word.name}"
  end
end
~~~
âš ï¸ Rakeã‚¿ã‚¹ã‚¯ã§å¼•æ•°ã‚’è¤‡æ•°å—ã‘å–ã‚‹å ´åˆã€ã‚¹ãƒšãƒ¼ã‚¹ã¯é–‹ã‘ãšã«ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã«ã™ã‚‹ã€‚    
***

### â“ ãƒ–ãƒ­ãƒƒã‚¯ã®ä¸­èº«ã® _ ã¯ãªã«ï¼Ÿï¼Ÿ
ã¾ãšã€ã‚¿ã‚¹ã‚¯ã«å¼•æ•°ã‚’æ¸¡ã™æ™‚ã¯ã‚·ãƒ³ãƒœãƒ«ã§æ¸¡ã™ã®ãŒä¸€èˆ¬çš„ã‚‰ã—ã„ã€‚  
ãã®ãŸã‚ã€ãƒ–ãƒ­ãƒƒã‚¯ã‚’æ¸¡ã™ã¨ã€ãƒ–ãƒ­ãƒƒã‚¯ã®ç¬¬ä¸€å¼•æ•°ã¯ã€Œã‚¿ã‚¹ã‚¯è‡ªä½“ã€ãŒå…¥ã£ã¦ã„ã¦ã€ä½¿ã‚ãªã„ã€‚  
å®Ÿéš›ã‚¿ã‚¹ã‚¯ã«ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦è¡¨ç¤ºã•ã›ã¦ã¿ã‚‹ã¨  
~~~
namespace :hello do
  desc 'hello+name'
  task :hello_name, [:name] do |task, word|
    puts task
  end
end

rails 'hello:hello_name[Tarara]'
=>
hello:hello_name
~~~
ã¨ãªã£ãŸã€‚  
ãã—ã¦ _ã¯é€šå¸¸ã€ãƒ–ãƒ­ãƒƒã‚¯å†…ã§ä½¿ã‚ã‚Œãªã„å¤‰æ•°ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ãŸã‚ã«ä½¿ã‚ã‚Œã‚‹ã€‚  
ãã®ãŸã‚ã€ãƒ–ãƒ­ãƒƒã‚¯ã®ç¬¬ä¸€å¼•æ•°ã‚’ _ã§æ›¸ã„ã¦ã„ã‚‹ã€‚(åå‰ä»–ã«ã¤ã‘ã¦ã‚‚ã‚‚ã¡ã‚ã‚“ã„ã„)  
***

### â“ ãªãœãƒ–ãƒ­ãƒƒã‚¯ã®ç¬¬äºŒå¼•æ•°ã‚’ãã®ã¾ã¾ä½¿ãˆãªã„ã®ï¼Ÿï¼Ÿ
ãªãœ `#{word.name}`ã¨ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ  
`#{word}`ã§ã¯ãƒ€ãƒ¡ãªã®ã‹ï¼Ÿï¼Ÿ  
  
ãã®ç­”ãˆã¨ã—ã¦ã¯ã€ãƒ–ãƒ­ãƒƒã‚¯ã®ç¬¬äºŒå¼•æ•°ã«ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå…¥ã‚‹ã‹ã‚‰ã€‚  
è©¦ã—ã«è¡¨ç¤ºã•ã›ã¦ã¿ã‚‹ã¨
~~~
namespace :hello do
  desc 'hello+name'
  task :hello_name, [:name] do |task, word|
    puts word
  end
end

$ rails 'hello:hello_name[Tarara]'
=>
#<Rake::TaskArguments name: Tarara>
~~~
ã¨ãªã£ãŸã€‚  
ãã®ãŸã‚ `#{word.name}`ã¨ã—ã¦æŠœãå‡ºã—ã¦ã„ã‚‹ã€‚
***

# ãƒ¡ãƒ¢: ã‚¿ã‚¹ã‚¯å†…ã§ä»–ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆ
~~~
namespace :tasks do
  task :task_1, [:word] do |_, args|
    puts "Hello, #{args.word}"
  end

  task :task_2 do
    Rake::Task['tasks:task_1'].invoke('Rails')
  end
end
~~~
***

# Rakeã‚¿ã‚¹ã‚¯ã®å®Ÿè¡Œ
~~~
$ rails ã‚¿ã‚¹ã‚¯ã®ãƒ•ã‚¡ã‚¤ãƒ«å:ã‚¿ã‚¹ã‚¯å

[ä¾‹]
$ rails hello:hello_name

[å¼•æ•°æ¸¡ã™å ´åˆ]
$ rails hello:hello_name[Tarara]

[Zshç’°å¢ƒã ã¨ã‚¯ã‚©ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§å›²ã¾ãªã„ã¨ no matches found:å‡ºã‚‹ã‹ã‚‚]
$ rails 'hello:hello_name[Tarara]'
~~~
***

# ã‚¿ã‚¹ã‚¯ã‚’è‡ªå‹•ã§å®Ÿè¡Œã•ã›ã‚‹
ä»Šã®ã¾ã¾ã ã¨ã€è‡ªåˆ†ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å©ã‹ãªã„ã¨å®Ÿè¡Œã•ã‚Œãªã„ã€‚  
ã‚³ãƒ¬ã‚’è‡ªå‹•åŒ–ã™ã‚‹ã«ã¯[ã‚³ãƒ¬](https://github.com/Tarara33/TIL/blob/main/Rails/Gem/whenever.md)ãŒå¿…è¦ã€‚
***
