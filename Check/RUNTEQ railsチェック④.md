# Chapter4

## マイグレーションってどういうものでどんなことが出来ますか？
開発状況に応じてデータベース内にテーブルやカラム、インデックスなどを追加/削除したり、   
既存データに修正を加えることを楽に行えるもの。
マイグレーションにおいては、１つのマイグレーションファイルが1つのバージョンとして扱われるので、    
バージョンの上げ下げを細かくできる。  
⚠️ファイルの作成だけでは変更は適応されない
~~~
$ bin/rails g migration マイグレーション名
マイグレーションファイル作成

ファイルに変更など記述した後
$ bin/rails db:migrate
=> 変更が適応される
~~~
現在のマイグレーションを確認したい時は「db/schema.rb」に書いてある
***

### マイグレーションコマンド
- `bin/rails or rails db:migrate`...最新までマイグレーションを適応する
- `bin/rails or rails db:migrate　VERSION=ファイル名の数字`...特定バージョンまでマイグレーションされた状態にする
例：「20220505120641_create_tasks.rb」だったら「20220505120641」をVERSION=に入れる
- `bin/rails or rails db:rollback`...バージョンを１つ戻す
- `bin/rails or rails db:rollback STEP=数字`...バージョンを指定したステップ数だけ戻す
- `bin/rails or rails db:migrate:redo`...バージョンを１つ戻してから上げる
（バージョンは最終的に変化しないが、バージョンを戻す処理が想定通り動くか簡単に確認できる）
***

## db/schema.rbってどういうファイルですか？
現在のデータベース構造を記入されてるファイル。   
自動出力される。
***

## モデルの「検証」(バリデーション)はどういうときに行われますか？
検証とはデータの内容が正しいかチェックすることを指す。   
railsにおけるモデルの検証とは、非常に自由度の高いチェックを行った上でユーザーにエラーをわかりやすく伝えたい時に使う。   
※データベースでも内容を空（null）で入れない（null: false）などバリデーションを定義できるが、    
種類は少ない＆エラー画面がユーザーにわかりにくい。   
ただ、モデルの検証は直接データベースに入力する時やプログラミング不備などで動かない時もあるので、    
どちらかだけではなく、モデルとデータベース両方のバリデーションを設定する
***

## モデルが「検証」に引っかかってから画面にエラーメッセージが表示される流れについて説明してください。
railsにおけるモデルの検証は基本的にモデルオブジェクトをデータベースに登録/更新する前に行い、   
エラーがあれば登録/更新をせずに差し戻す仕組みである。   
ただ、検証（validates）を設定しただけでは、エラーが出たときビューには表示されない。    
画面に出すには（例えば、フォーム画面で:nameの空欄NG,１０文字以内）
~~~
[app/models/tasks.rb]
class Task < ApplicationRecord
  validates :name, presence: true, length: {maximum: 30}
end

[app/views/tasks.html]
フォーム欄の上に
<% if tasks.errors.present? %>
  <ul id = "error_explanation">
    <% task.errors.full_messages.each do |message| %>
      <li> message </li>
  </ul>
~~~
⚠️エラーメッセージが１件とは限らないの（今回の例題の場合、空欄です。と文字数オーバーですが出る可能性ある）で、    
present?メソッドを使いeach文で取得する。（presentは全データ取得、any?は１件だけ）   
***

## セッションってどういうものですか？
ステートフルな通信を実現するための仕組み。 
保存場所：ブラウザ、サーバー    
保存期間：ユーザーがブラウザを閉じるか、サイトを離れると情報が削除される。   
無視できるか：できない
***

### ステートフル　と　ステートレスの違い
- ステートフル...以前のセッション状態を保持して、その後の処理結果に反映させる通信プロトコルやアプリケーション
- ステートレス...以前のセッション情報を保持せず、「前後の状況に関係なくその都度いつも同じレスポンスを返すようなプロトコル」

人間の会話で例え見ると、    
1回目でやりとりした相手を2回目に会ったとき、覚えていることをステートフル   
1回目でやりとりした相手を2回目に会ったとき、覚えていないことをステートレス、と例える
***

## Cookieってどういうものですか？
一度訪問したWebサイトに再度訪問するときに、IDやパスワードの情報を再入力せずログインできる仕組みのこと。    
保存場所：クライアント側のマシン（主にブラウザ）にのみ保存
保存期間：永続クッキーがあり、情報を保持し続ける  
無視できるか：できる
***

## has_secure_passwordはどういうときに使いますか？
ユーザーから入力されたパスワード
