[参考](https://en-junior.com/security-group/#index_id0)

# セキュリティーグループ
セキュリティグループとは、「誰からの」「どんな」通信なら受け入れるのかを決めたルールのこと。

[![Image from Gyazo](https://i.gyazo.com/d750bd23fbf665bdcd7908b0b0ebd190.png)](https://gyazo.com/d750bd23fbf665bdcd7908b0b0ebd190)

また逆に EC2から「誰に対して」「どんな」通信が出ていくことがでいるのか？もセキュリティグループで管理される。

[![Image from Gyazo](https://i.gyazo.com/0bee500838b79721a8ccaff54880a533.png)](https://gyazo.com/0bee500838b79721a8ccaff54880a533)
***

# 作り方
VPCコンソールの中の左メニューのセキュリティの部分にある、セキュリティーグループで作成。

フォームでは、名前などの下にこのような欄が出てくる。  
インバウンドは、情報が入ってくる時のルール・アウトバウンドは、情報が出て行く時のルールを設定する。

[![Image from Gyazo](https://i.gyazo.com/1852ee677a21c32133239f13ec28a11b.png)](https://gyazo.com/1852ee677a21c32133239f13ec28a11b)
***

## タイプ・プロトコル・ポート範囲
### タイプ
タイプは「どんな通信か？」を指定する項目。  
例えば、「メールの送受信」や「Web情報の送受信」、「SSHによるリモート接続」など。  
***
  
### プロトコル
プロトコルというのは、先ほどの「どんな通信か？」をルール化したもので、  
郵便で考えると「定型郵便」とか「レターパック」などの郵便の種類に該当する。  
セキュリティグループでは、これらを[プロトコル](https://wa3.i-3-i.info/word11.html)名で指定する。    
タイプを指定すると、自動的に埋まる。    
***

### ポート範囲
ネットワークの通信では、IPアドレスで相手を特定した後、さらに[ポート番号](https://wa3.i-3-i.info/word171.html)という番号を用いて通信を行う。    
例えば、市役所などを利用するときに、「戸籍関係なら1番窓口」「子育て関係なら5番窓口」のように、役割ごとに番号がある感じ。    
そしてこれもタイプを選ぶと自動的に埋まる。  
***

## ソース・送信先
セキュリティグループは、  
インバウンドルールで「誰からの通信を許可するか」を設定し、アウトバウンドルールで「誰への通信を許可するか」を設定する。  
この、インバウンドルールにおける「誰からの」を指定するのが「ソース」で、    
アウトバウンドルールにおける「誰への」を指定するのが「送信先」となる。  

そしてそれぞれ、IPアドレスで指定する方法と、セキュリティグループのIDで指定する方法の2種類がある。
***

### IPアドレス
以下の４つからとなる
- カスタム
- Anywhere-IPv4
- Anywhere-IPv6
- マイIP

このうち、「Anywhere-IPv4」と「Anywhere-IPv6」は、すべてのIPアドレス（誰でもOK）を表す。(バージョンが違うだけ)  

「マイIP」を選ぶと、現在マネジメントコンソールにアクセスしている自分自身のIPアドレスが自動的に入力される。  
**=>** 自分のPCのみの通信を許可したい場合に利用する。  

「カスタム」は、自分でIPアドレスを [CIDR記法](https://github.com/Tarara33/TIL/blob/main/%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC/AWS/VPC.md#-cidr)で入力する。
***

### セキュリティグループのID
セキュリティグループのIDを設定する意味としては、  
この「ソース」に指定されたセキュリティグループIDが関連づけられた EC2からの通信のみを許可するという意味。  
データーベース用のセキュリティーグループとかに使う。

[![Image from Gyazo](https://i.gyazo.com/b74774200bcf5fd4055bef7223a32458.png)](https://gyazo.com/b74774200bcf5fd4055bef7223a32458)
***

### 💡 セキュリティグループのIDを使う利点
基本的に EC2の IPアドレスは固定ではなく、停止・起動するたびに変わってしまう。(Elastic IPアドレスを作れば変わらない)  

そのため、EC2の IPアドレスを指定した場合、    
そのEC2の IPアドレスが変わるたびにセキュリティグループを修正する必要になるが、それは現実的ではない。  

しかしセキュリティグループのIDを使えば、IPアドレスが変わっても、セキュリティグループのIDは変わらないので、守れる！
***
