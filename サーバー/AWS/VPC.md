<img width="733" alt="image" src="https://github.com/Tarara33/TIL/assets/128697599/8e57175a-f11c-4ee4-966d-381f3fd8eb90">[参考](https://en-junior.com/vpc/#index_id0)

# VPCとは
「Virtual Private Cloud」の略で、直訳すると「仮想的な自分専用クラウド」  
「AWS上に、あなた専用の、隔離されたプライベートなネットワーク空間を作ることができますよ」ということ。

[![Image from Gyazo](https://i.gyazo.com/d65b63a3cbc39a28dcba1b9e8d9be7ff.png)](https://gyazo.com/d65b63a3cbc39a28dcba1b9e8d9be7ff)

初期段階で各リージョン(地域)ごとでデフォルトの VPCなどが設定されているのでそれを使うこともできる。
***

# 作り方(デフォルト VPCの場合)
- VPCのページにページに飛ぶ
- VPC dashboardの VPCを押す
- デフォルトの使う場合、nameがからなので名前つける
***

# 作り方(オリジナル VPCの場合)
- VPCのページにページに飛ぶ
- VPC dashboardの VPCを押す
- 右上の VPC作成を押す。
- フォームが出てくるので、名前と CIDRを入力
***

## ❓ CIDR
[プライベートIPアドレス](https://github.com/Tarara33/TIL/blob/main/%E3%82%A4%E3%83%B3%E3%83%95%E3%83%A9/IP%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9.md#ip%E3%82%A2%E3%83%89%E3%83%AC%E3%82%B9)のネットワーク部とホスト部の範囲を表すこと。  
スラッシュを使って、ネットワーク部とホスト部の分かれ目を表現する。    
例えば、「192.168.0.0/16」であれば最初の16桁がネットワーク部で、  
「192.168.0.0/24」であれば最初の24桁がネットワーク部。  

このようにネットワーク部とホスト部の分かれ目を表現する方法だが、転じて IPアドレスの範囲を表すこともできる。  
例えば、「192.168.0.0/24」だと、このネットワークのプライベート IPアドレスは、「192.168.0.0〜192.168.0.255」の256個。  
このことから、「192.168.0.0/24」という表記で「192.168.0.0〜192.168.0.255の範囲」と捉えることする。  
***

#  VPCに関連するもの
実は VPCを作っただけではまだサーバーなどを作成することはできない。  
このように、 VPCを作るフォームで「VPCなど」を選択するとこのような画面が出る。 

[![Image from Gyazo](https://i.gyazo.com/0cd2573bccbf4e81d54737b1e9cfc031.png)](https://gyazo.com/0cd2573bccbf4e81d54737b1e9cfc031)

つまり、これらのものが必要。  
そして作成するときは VPCコンソールの左メニューからそれぞれ選ぶ。  
そしてそれぞれ名前と、対応する VPCを入力して作る。
***

# サブネット
VPCの中に、サブネットというさらに小さなネットワークを作成する必要がある。  
VPCはリージョン(地域)に作成されますが、  
サブネットはリージョンの中のアベイラビリティゾーンに作成するイメージ。

ちなみに、サブネットが分かれていようと同じ VPC内であればサブネット同士で通信することができる。

[![Image from Gyazo](https://i.gyazo.com/13f1ae90b172482dc2514fd6e47b4d2d.png)](https://gyazo.com/13f1ae90b172482dc2514fd6e47b4d2d)
***

### ❓ アベイラビリティゾーン(AZ)
これはサーバーを物理的に置いているデータセンターについて、各リージョンで地域毎にデータセンターを分けた集合の単位のこと
***

## パブリックサブネット・プライベートサブネット
フォームの部分をよく見ると、サブネットはパブリックとプライベートの２種類ある。  
プライベートサブネット内のサーバーは、同じ VPC内でのみ通信が可能だが、  
パブリックサブネットは外のネットワーク（インターネット）とも通信が可能。

[![Image from Gyazo](https://i.gyazo.com/1ac5fb9bf8e117a2c43bd938224005a7.png)](https://gyazo.com/1ac5fb9bf8e117a2c43bd938224005a7)
***

# インターネットゲートウェイ
パブリックサブネットはインターネットと通信ができるが、それはインターネットゲートウェイという VPCのサービスのおかげである。

[![Image from Gyazo](https://i.gyazo.com/6534fd6239746cddfead9652853d50d6.png)](https://gyazo.com/6534fd6239746cddfead9652853d50d6)

一方で、プライベートサブネットはこの門を通ることができないため、インターネットと通信ができない。
***

## NATゲートウェイ
プライベートサブネットがインターネットと通信するためには、NATゲートウェイというサービスを使う必要がある。  

**💡 同じ VPC内部であればサブネット間での通信は可能**  
**=>** パブリックサブネットに、プライベートサブネットからの通信をインターネットゲートウェイへ中継してくれる機能を追加すれば、    
間接的にプライベートサブネットの通信をインターネットに繋げることができるようになる。   
**=>** それが NATゲートウェイ!

[![Image from Gyazo](https://i.gyazo.com/4e3555f6ec1898a0383be8e762428fc5.png)](https://gyazo.com/4e3555f6ec1898a0383be8e762428fc5)

⚠️ 料金がけっこう高い
***

# ルートテーブル
ルートテーブルとは、VPC内の通信を振り分けるルールの一覧のこと。
VPCで発生する通信は、以下のような経路を辿る。

1. VPC内の他のリソース（EC2など）へ送信する
2. インターネットゲートウェイへ送信する
3. NATゲートウェイへ送信する

このように、「どんな通信を」「どこへ送信するか」を決めたものがルートテーブル。
***

##### ⭐️ さらに作成した方がいいもの ([セキュリティーグループ](https://github.com/Tarara33/TIL/blob/main/%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC/AWS/%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97.md))
***
